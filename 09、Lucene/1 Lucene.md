## ç®€è¿°

**Lucene**æ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å·¥å…·åŒ…ã€‚

å…¨æ–‡æ£€ç´¢æ˜¯æŒ‡ï¼šå°†ä¸€æ®µæ–‡å­—æˆ–ä¸€ç¯‡æ–‡æ¡£ï¼Œå…ˆè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œç„¶åå°†è¯å’Œæ–‡æ¡£å»ºç«‹æ˜ å°„ï¼Œå¹¶å°†æ˜ å°„ç»„ç»‡ä¸ºç´¢å¼•ï¼Œä¹‹åé€šè¿‡åœ¨ç´¢å¼•ä¸­æ£€ç´¢è¯ï¼Œå°±å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„æ–‡ç« ï¼ˆå…¨æ–‡ï¼‰ï¼Œè€Œå»ºç«‹çš„ç´¢å¼•ä¹Ÿç§°ä¸ºå€’æ’ç´¢å¼•ã€‚

> ä¸€èˆ¬è¯´çš„ç´¢å¼•éƒ½æ˜¯æŒ‡å€’æ’ç´¢å¼•ï¼Œå› ä¸ºæ­£æ’ç´¢å¼•æ˜¯æŒ‰ç…§è®°å½•ä¸»é”®æ’åºçš„ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ï¼Œä¸é€‚åˆç´¢å¼•æ–‡æ¡£ã€‚
>
> â€œå€’æ’ç´¢å¼•â€ä¸­çš„â€œå€’æ’â€æœ‰å¿…è¦å—ï¼Ÿç´¢å¼•ä¸éƒ½æ˜¯å­—æ®µæŒ‡å‘IDï¼Œä¸éƒ½æ˜¯å€’æ’çš„å—ï¼Ÿ
>

åŸºäº**Lucene**çš„é¡¹ç›®ä¸»è¦æœ‰ï¼š

1. **Apache Nutch**ï¼Œä¸€ä¸ªé«˜æ‰©å±•æ€§çš„ç½‘ç»œçˆ¬è™«é¡¹ç›®ã€‚
2. **Apache Solr**ï¼Œä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“ã€‚
3. **Elasticsearch**ï¼Œä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“ã€‚



## Apache Nutch[[1]](https://blog.csdn.net/weixin_44037478/article/details/86492924)

**Nutch**ä¸€ä¸ªçˆ¬è™«é¡¹ç›®ï¼Œé™¤äº†èƒ½å¤Ÿçˆ¬å–ç½‘é¡µï¼Œè¿˜èƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤ç½‘é¡µçš„URLä¿¡æ¯ï¼ˆå»é‡ã€å®šæ—¶æ›´æ–°ã€é‡å®šå‘ç­‰ï¼‰ã€‚

**Nutch**é‡‡ç”¨**MapReduce**æ¥çˆ¬å–ã€è§£æç½‘é¡µï¼Œå¹¶åœ¨0.8ç‰ˆæœ¬ä¸­å°†**MapReduce**å’Œ**HDFS**å‰¥ç¦»æˆäº†å•ç‹¬çš„é¡¹ç›®â€”â€”**Hadoop**ï¼Œå½“ç„¶**Nutch**ä»æ—§åŸºäº**Hadoop**ã€‚

> æ—¢ç„¶åŸºäº**Hadoop**ï¼Œä½ å¯èƒ½ä¼šçŒœåˆ°**Nutch**å¯ä»¥å°†**HBase**ä½œä¸ºå‚¨å­˜å·¥å…·ã€‚

> **Hadoop**æ˜¯Doug Cutting[æ ¹æ®](https://zhuanlan.zhihu.com/p/163636311)å„¿å­çš„å¤§è±¡ç©å¶ç”Ÿé€ å‡ºæ¥çš„ã€‚
>
> - **MySQL**[æ˜¯](https://learnku.com/articles/40537)Michael Monty Wideniusæ ¹æ®å¥³å„¿Myæ¥è¿›è¡Œå‘½åçš„ï¼›**MaxDB**æ˜¯Montyæ ¹æ®å„¿å­Maxæ¥å‘½åçš„ï¼›**MariaDB**æ˜¯Montyæ ¹æ®å­™å¥³Mariaçš„åå­—æ¥å‘½åçš„ã€‚
> - Doug Cuttingä¹Ÿæ˜¯**Lucene**ã€**Nutch**ã€**Avro**çš„åˆ›å§‹äººã€‚
>- **Lucene**è¯ç”Ÿäº1997å¹´ï¼Œ**Nutch**è¯ç”Ÿäº2004å¹´ï¼Œ**Hadoop**è¯ç”Ÿäº2006å¹´ã€‚
> 
>**Google**åˆ›å»ºäº1998å¹´ï¼Œä¸‰å¤§è®ºæ–‡å‘è¡¨äº2003~2006å¹´ã€‚
> 
>äº’è”ç½‘æ³¡æ²«å‘ç”Ÿäº1995~2001å¹´ã€‚

ä»1.2ç‰ˆæœ¬ä»¥åï¼Œ**Nutch**ä¸å†æä¾›æœç´¢åŠŸèƒ½ï¼Œä½†æ˜¯èƒ½å¤Ÿå‘**Solr**ç­‰æœç´¢å¼•æ“æäº¤çˆ¬å–çš„ç½‘é¡µã€‚



## Apache Solrä¸Elasticsearch

**Solr**å’Œ**Elasticsearch**å•è®ºå…¨æ–‡æ£€ç´¢åŠŸèƒ½ï¼Œæ€§èƒ½ã€æ˜“ç”¨æ€§éƒ½å·®ä¸å¤šï¼Œæ¯•ç«Ÿéƒ½æ˜¯åŸºäº**Lucene**ï¼›ç»å†äº†é•¿æœŸçš„å‘å±•ï¼Œä¸¤è€…åœ¨å¯æ‰©å±•æ€§ã€åˆ†å¸ƒå¼é—®é¢˜ä¸Šçš„è¡¨ç°ç›¸ä»¿ã€‚

ä¸åŒçš„æ˜¯ï¼Œ**Solr**æ”¯æŒéå¸¸å¤æ‚çš„æŸ¥è¯¢ï¼Œè€Œ**Elasticsearch**çš„èšåˆåˆ†æåŠŸèƒ½æ›´å¼ºã€‚

å¦å¤–ä¸€ç‚¹ä¸åŒæ˜¯ï¼Œ**Elasticsearch**æ›´åŠ æ˜“ä¸Šæ‰‹ï¼Œä½†æ˜¯ç”±å•†ä¸šå…¬å¸**Elastic**æ¥ç»´æŠ¤å¼€æºå·¥ä½œï¼Œè€Œ**Solr**æ˜¯å¼€æºç¤¾åŒºç»´æŠ¤ï¼Œè€Œä¸”å¼€æºæ—¶é—´æ—©ï¼Œç”±å¤§é‡çš„æ–‡æ¡£å¯æŸ¥é˜…ã€‚

> æ¥è‡ªæ–‡ç« ã€Š[Solr vs Elasticsearch](https://logz.io/blog/solr-vs-elasticsearch/)ã€‹ï¼Œå¦æœ‰[è¯‘æ–‡](https://www.cnblogs.com/xiaoqi/p/solr-vs-elasticsearch.html)ã€‚



## MySQLã€Elasticsearchã€HBase

### åœºæ™¯[[2]](https://www.jianshu.com/p/4e412f48e820)â­

ä¸‰è€…æ¶‰åŠä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä½¿å¾—ä¸‰è€…çš„è¯»å†™è®¾è®¡ã€åŸç†ä¹Ÿä¸ç›¸åŒï¼š

- **MySQL**å¯¹<span style=background:#c2e2ff>å…³ç³»</span>çš„è¡¨ç¤ºå’Œ<span style=background:#c2e2ff>äº‹åŠ¡</span>çš„æ”¯æŒæ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚

- **Elasticsearch**ä¸»è¦é’ˆå¯¹<span style=background:#c2e2ff>å…¨æ–‡æ£€ç´¢</span>åœºæ™¯ã€‚

- **HBase**é€‚åˆä»¥å®ä½“ä¸ºä¸­å¿ƒçš„<span style=background:#c2e2ff>æµ·é‡</span>æ•°æ®çš„<span style=background:#c2e2ff>é«˜å¹¶å‘å†™å…¥</span>å’Œ<span style=background:#c2e2ff>å®æ—¶</span>è¯»å–ã€‚

**MySQL**ã€**Elasticsearch**éƒ½èƒ½è¿›è¡Œå¤æ‚æ¡ä»¶çš„æŸ¥è¯¢ã€èšåˆï¼Œä½†**Elasticsearch**å¤©ç”Ÿåˆ†å¸ƒå¼ï¼Œæ€§èƒ½è¦å¥½ä¸€äº›ã€‚

**MySQL**å•è¡¨æ•°æ®è¾¾åƒä¸‡æ¡åå°±ä¼šå˜æ…¢ï¼Œ**HBase**åˆ™ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºå¤©ç”Ÿåˆ†å¸ƒå¼ã€‚

### æ•°æ®ä¸€è‡´æ€§â­

**Elasticsearch** + **HBase**çš„ç»„åˆï¼Œæ˜¯æœç´¢ + è¯¦æƒ…åœºæ™¯çš„å¸¸è§è§£å†³æ–¹æ¡ˆã€‚

å¯¹äºè¿™ç§â€œåŒä¸€ä»½æ•°æ®ä¿å­˜åœ¨ä¸åŒæ•°æ®æºâ€çš„åœºæ™¯ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ˜¯ä¸€ä¸ªä¸å®¹å¿½è§†çš„é—®é¢˜ã€‚

ä¸€ä»½æ•°æ®å¾€å¾€æ˜¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘åˆ°ä¸åŒçš„æ•°æ®æºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å †ç§¯ï¼Œæˆ–è€…è¯´æ˜¯åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯¹æŒä¹…åŒ–çš„æ”¯æŒï¼Œé‡‡ç”¨å»¶è¿Ÿæ¶ˆè´¹çš„æ–¹å¼ï¼Œå¯¹ä¸åŒæ•°æ®æºä¸­çš„æ•°æ®è¿›è¡Œæ ¸å¯¹ï¼Œæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚

> æ¶ˆæ¯é˜Ÿåˆ—ä¸ä¸¢æ¶ˆæ¯æ˜¯é‡è¦å‰ææ¡ä»¶ã€‚
>
> å»¶è¿Ÿè€Œéå®æ—¶ï¼Œæ˜¯ä¸ºäº†ç¡®ä¿å„ä¸ªæ•°æ®æºä¸­çš„æ•°æ®è½ç›˜ï¼›å»¶è¿Ÿè€Œéå®æ—¶ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæ˜¯ä¸ºäº†å‡è½»å„ä¸ªæ•°æ®æºçš„IOï¼Œé¿å…ã€ç¼“è§£IOæ¯›åˆºã€‚



## æ•°æ®ç»“æ„ğŸŒ™

### ä¸»è¦æ–‡ä»¶[[3]](https://elasticsearch.cn/article/6178#tip4)

- ##### Field Index
  - `*.fdx`
  - æ­£æ’ç´¢å¼•ï¼Œå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œç”¨äºæ ¹æ®æ–‡æ¡£IDç›´æ¥æŸ¥è¯¢æ–‡æ¡£ã€‚
  
- ##### Field Data

  - `*.fdt`
  - å­˜å‚¨äº†æ­£æ’å­˜å‚¨æ•°æ®ï¼Œå³ï¼Œä¿å­˜äº†å†™å…¥çš„åŸæ–‡ã€‚

- ##### <span style=background:#c9ccff>Term Dictionary</span>
  - `*.tim`
  - å€’æ’ç´¢å¼•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä½¿ç”¨<span style=background:#c2e2ff>äºŒåˆ†æŸ¥æ‰¾</span>ã€‚
  - <span style=background:#c9ccff>Term Dictionary</span>æŒ‰å—å­˜å‚¨ï¼Œæ¯ä¸ª**Block**åˆä¼šåˆ©ç”¨å…¬å…±å‰ç¼€å‹ç¼©ï¼Œä»è€ŒèŠ‚çœç©ºé—´ï¼Œå¦‚ï¼Œ`Ab`å¼€å¤´çš„å•è¯ï¼Œå°±å¯ä»¥æŠŠ`Ab`çœå»ã€‚
  
- ##### Term Index

  - `*.tip`
  - äºŒçº§ç´¢å¼•ï¼Œä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚

- ##### Per-Document Values
  - `*.dvd`ã€`*.dvm`
  - ä¿å­˜Doc-Valuesï¼Œç”¨äº<u>èšåˆ</u>å’Œ<u>æ’åº</u>ã€‚
  
  > å€’æ’ç´¢å¼•æ˜¯`Term-to-DocId`çš„å½¢å¼ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æŸ¥è¯¢æ—¶ä¸åªå¸Œæœ›é€šè¿‡åˆ†è¯æŸ¥è¯¢åˆ°æ–‡æ¡£ï¼Œè¿˜å¸Œæœ›è¿›è¡Œèšåˆåˆ†æã€å¯¹åˆ†è¯æ‰€å±çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ã€æ’åºï¼Œæ‰€ä»¥**Elasticsearch**åœ¨å†™å…¥å€’æ’ç´¢å¼•æ—¶è¿˜ä¼šå°†`Doc-to-Values`å†™å…¥ã€‚
  
- ##### Term Vector Data

  - `*.tvx`ã€`*.tvd`ã€`*.tvf`
  - è®°å½•äº†ä¸€ä¸ª**Document**ä¸­æ¯ä¸ª**Term**çš„ä½ç½®ï¼Œæ˜¯å®ç°å…³é”®è¯é«˜äº®çš„åŸºç¡€ã€‚

### å­—å…¸ä¸æ–‡æ¡£åˆ—è¡¨[[4]](https://www.infoq.cn/article/database-timestamp-02)

<span style=background:#c9ccff>Term Dictionary</span>ä¼šæŒ‡å‘<span style=background:#f8d2ff>Posting List</span>ï¼š<span style=background:#c9ccff>Term Dictionary</span>ä¸­ä¿å­˜**Term**ï¼Œä»¥åŠ**Term**å¯¹åº”çš„<span style=background:#f8d2ff>Posting List</span>çš„æŒ‡é’ˆã€‚

<span style=background:#f8d2ff>Posting List</span>æ˜¯ä¸€ä¸ª`int[]`ï¼Œå­˜å‚¨äº†æ‰€æœ‰ç¬¦åˆæŸä¸ª**Term**çš„æ–‡æ¡£IDã€‚

![](../images/9/lucene_index_file.jpg)

### ç´¢å¼•çš„ç´¢å¼•

<span style=background:#c2e2ff>Term Index</span>æ˜¯å¯¹<span style=background:#c9ccff>Term Dictionary</span>çš„ç´¢å¼•ã€‚

å› ä¸º<span style=background:#c9ccff>Term Dictionary</span>çš„ä½“ç§¯å¤ªå¤§ï¼Œæ‰€ä»¥æ— æ³•å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œè€Œ<span style=background:#c2e2ff>Term Index</span>çš„å¼•å…¥ï¼Œèƒ½å‡å°‘å¯¹<span style=background:#c9ccff>Term Dictionary</span>çš„å¯»å€æ¬¡æ•°ã€‚

<span style=background:#c2e2ff>Term Index</span>é‡‡ç”¨Trieæ ‘ä½œä¸ºæ•°æ®ç»“æ„ï¼Œå¹¶é‡‡ç”¨å‹ç¼©ï¼Œä½¿å¾—è‡ªå·±çš„ä½“ç§¯åªæœ‰æ‰€æœ‰**Term**ä½“ç§¯ä¹‹å’Œçš„å‡ ååˆ†ä¹‹ä¸€ï¼Œä»è€Œä½¿å¾—è‡ªå·±å¯ä»¥å…¨éƒ¨æ”¾å…¥å†…å­˜ã€‚

> Trieï¼Œå‰ç¼€æ ‘ã€å­—å…¸æ ‘

![](../images/9/elasticsearch_trie_tree.png)

### è”åˆç´¢å¼•

**Elasticsearch**é€šè¿‡å°†<span style=background:#f8d2ff>Posting List</span>è½¬æ¢æˆ**Skip List**æˆ–**Bitset**ï¼Œç„¶åè¿›è¡Œè¿ç®—æ¥å®ç°è”åˆç´¢å¼•ã€‚

> è€Œ**MySQL**éœ€è¦æå‰å»ºç«‹è”åˆç´¢å¼•ï¼Œå¦åˆ™åªä¼šé‡‡ç”¨å¤šä¸ªå•åˆ—ç´¢å¼•ä¸­çš„ä¸€ä¸ªã€‚

#### Skip List

![](../images/9/elasticsearch_skip_list.png)

- å°†æ¡ä»¶å­—æ®µçš„<span style=background:#f8d2ff>Posting List</span>è½¬æ¢æˆ**Skip List**ï¼Œç„¶ååŒæ—¶éå†è¿™äº›**Skip List**ï¼Œç›¸äº’Skipã€‚
- **Lucene**ä¼šå¯¹**Skip List**ä¸­çš„**Block**è¿›è¡ŒåŸºäº<span style=background:#c2e2ff>Frame Of Reference</span>çš„å‹ç¼©ï¼Œä»¥é€‚åº”ä½åŒºåˆ†åº¦ï¼ˆlow cardinalityï¼‰ã€é¢‘ç¹å‡ºç°çš„**Term**ï¼Œå¦‚æ€§åˆ«ä¸­çš„â€œç”·â€ã€â€œå¥³â€ã€‚
- <span style=background:#c2e2ff>Frame Of Reference</span>çš„å‹ç¼©æ€è·¯ä¸ºï¼šå¢é‡åˆ—è¡¨ã€å¤šçº§ç´¢å¼•ã€‚

![](../images/9/lucene_frame_of_reference.png)

#### Bitset

- å°†æ¡ä»¶å­—æ®µçš„`filter`è½¬æ¢æˆ**Bitset**ï¼Œç„¶åå¯¹è¿™äº›**Bitset**åšé›†åˆè¿ç®—ã€‚
- **Lucene**ä¸­çš„**Bitset**ä½¿ç”¨äº†<span style=background:#c2e2ff>Roaring Bitmaps</span>çš„æ•°æ®ç»“æ„ï¼Œæ‹¥æœ‰è‰¯å¥½çš„å‹ç¼©æ•ˆæœã€å¿«é€Ÿçš„é€»è¾‘ï¼ˆAndã€Orï¼‰æ“ä½œã€‚
- <span style=background:#c2e2ff>Roaring Bitmaps</span>çš„å‹ç¼©æ€è·¯ä¸ºï¼šä¸å…¶ä¿å­˜100ä¸ª0ï¼Œå ç”¨100ä¸ªbitï¼Œè¿˜ä¸å¦‚ä¿å­˜ä¸€æ¬¡0ï¼Œç„¶åå£°æ˜è¿™ä¸ª0é‡å¤äº†100éã€‚

![](../images/9/lucene_roaring_bitmaps.png)

#### Skip Listä¸Bitset

å¦‚æœ`filter`ä»¥**Bitset**çš„å½¢å¼ç¼“å­˜åˆ°äº†å†…å­˜ä¸­ï¼Œå°±ä¼šä½¿ç”¨**Bitset**ï¼Œå¦åˆ™ä½¿ç”¨**Skip List**ã€‚

å¯¹äºç®€å•çš„ç›¸ç­‰æ¡ä»¶çš„`filter`ï¼Œéœ€è¦è¯»ç£ç›˜çš„**Skip List**æ¯”éœ€è¦ç¼“å­˜æˆå†…å­˜çš„**Bitset**[è¿˜è¦å¿«](https://www.elastic.co/blog/frame-of-reference-and-roaring-bitmaps)ã€‚



