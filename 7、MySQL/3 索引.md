### 联合索引

联合索引也称复合索引，创建时应遵循以下原则：

1. 联合索引是按照“最左原则”进行匹配的，区分度越高的索引应越往左放，这样查询效率较高。
2. 尽量的扩展索引，不要新建索引。
3. 索引列不参与计算，否则成本高，效率低。

在使用联合索引是，我们要注意：

1. 过滤条件中，AND和IN可以乱序使用，查询优化器可会自动优化。
2. 索引列的关系均为AND，[OR](https://segmentfault.com/q/1010000003984016/a-1020000003984281)之后的条件不进行联合索引的匹配。
3. 过滤条件中的[索引列遇到范围过滤](https://www.cnblogs.com/rjzheng/p/12557314.html)条件（>、<、BETWEEN、LIKE），会在该条件列上停止联合索引的向右匹配。

一个表可以拥有多个索引，MySQL会根据查询语句的成本[自动选择](https://www.cnblogs.com/krisy/archive/2013/07/12/3186258.html)其中的一个索引，对于联合索引来说，MySQL只根据最左侧字段，所以有时MySQL选择的索引不是我们期望的、效率最高的索引。

索引的数量不是越多越好，也不是越少越好，讲究一个适中。索引是需要数据库不断进行维护的，索引数量越多，代表我们可以加速更多的查询，但同时增加维护开销，降低写入速度。

对于值不重复的单字段、组合字段，我们可以建立unique索引。Primary Key的索引也可以看作unique索引的一种。

一篇关于联合索引的[归纳](https://www.cnblogs.com/softidea/p/5977860.html)



### 聚集索引和非聚集索引

聚集索引和非聚集索引均采用B+树的设计，其索引可分为2类：

1. 非聚集索引

   1. 叶节点不存储数据，索引文件、数据文件相互独立。
   2. MyISAM的索引均为非聚集索引，叶节点存储数据记录的地址。

2. 聚族索引

   1. 叶结点保存数据记录，索引文件、数据文件合二为一。
   2. InnoDB的主索引为聚族索引，辅助索引均为聚族索引，叶节点存储主键，所以主键不宜过大。

   3. 所谓聚族，是指按主键聚集，换句话说，其索引项只能为主键。

      1. 所以即便我们不显式指定主键，InnoDB也会自动选择一个可以唯一标识记录的列作为主键；如果不存在这种列，InnoDB则会自动生成一列自增的6字节的长整型列作为隐式主键。

   4. 聚集索引最好选择自增整数作为主键，而非随机字符串，这样做能保证**顺序追加**写入记录，减少对已有记录的移动，减少开销。但在[高并发写入时会](https://segmentfault.com/a/1190000022206424)导致间隙锁竞争问题，同时自增也是靠锁实现的，会降低写入性能、阻塞事务。