<span style=background:#ffee7c>[索引基础知识](https://blog.hufeifei.cn/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/)</span>



### 联合索引

<span style=background:#c2e2ff>联合索引</span>也称复合索引，创建时应遵循以下原则：

1. <span style=background:#c2e2ff>联合索引</span>是按照“最左原则”进行匹配的，区分度越高的索引应越往左放，这样查询效率较高。
2. 尽量的扩展索引，不要新建索引。
3. 索引列不参与计算，否则成本高，效率低。

在使用<span style=background:#c2e2ff>联合索引</span>是，我们要注意：

1. 过滤条件中，`AND`和`IN`可以乱序使用，**Optimizer**会自动优化。
2. 索引列的关系均为`AND`，`OR`[之后的条件不进行联合索引的匹配](https://segmentfault.com/q/1010000003984016/a-1020000003984281)。
3. 过滤条件中的[索引列遇到范围过滤](https://www.cnblogs.com/rjzheng/p/12557314.html)条件（>、<、`BETWEEN`、`LIKE`），会在该条件列上停止联合索引的向右匹配。

一个表可以拥有多个索引，**Optimizer**会根据 [查询成本](https://blog.csdn.net/loongshawn/article/details/106470352) [自动选择](https://www.cnblogs.com/krisy/archive/2013/07/12/3186258.html)其中的一个索引，对于<span style=background:#c2e2ff>联合索引</span>来说，**MySQL**只根据最左侧字段，所以有时**MySQL**选择的索引不是我们期望的、效率最高的索引。

索引的数量不是越多越好，也不是越少越好，讲究一个适中。索引是需要数据库不断进行维护的，索引数量越多，代表我们可以加速更多的查询，但同时增加维护开销，降低写入速度。

对于值不重复的单字段、组合字段，我们可以建立<span style=background:#c2e2ff>联合索引</span>。Primary Key的索引也可以看作<span style=background:#c2e2ff>联合索引</span>的一种。

一篇关于<span style=background:#c2e2ff>联合索引</span>的[归纳](https://www.cnblogs.com/softidea/p/5977860.html)



### 聚集索引和非聚集索引

<span style=background:#c2e2ff>聚集索引</span>和<span style=background:#c2e2ff>非聚集索引</span>均采用B+树的设计，其索引可分为2类：

1. #### 非聚集索引

   1. 叶节点不存储数据，索引文件、数据文件相互独立。
   2. **MyISAM**的索引均为<span style=background:#c2e2ff>非聚集索引</span>，叶节点存储数据记录的地址。
   
2. #### 聚族索引

   1. 叶结点保存数据记录，索引文件、数据文件合二为一。
   2. **InnoDB**的主索引为<span style=background:#c2e2ff>聚族索引</span>，<span style=background:#c2e2ff>辅助索引</span>均为<span style=background:#c2e2ff>非聚族索引</span>，叶节点存储主键，所以主键不宜过大。
      1. <span style=background:#c2e2ff>辅助索引</span>也称<span style=background:#c2e2ff>二级索引</span>。
   3. 所谓聚族，是指按主键聚集，换句话说，其索引项只能为主键。

      1. 所以即便我们不显式指定主键，**InnoDB**也会自动选择一个可以唯一标识记录的列作为主键；
      2. 如果不存在这种列，**InnoDB**则会自动生成一列自增的6字节的长整型列作为隐式主键。
   4. <span style=background:#c2e2ff>聚集索引</span>最好选择自增整数作为主键，而非随机字符串，这样做能保证<span style=background:#c2e2ff>顺序追加</span>写入记录，减少对已有记录的移动，减少开销。但在[高并发写入时会](https://segmentfault.com/a/1190000022206424)导致<span style=background:#c9ccff>间隙锁</span>竞争问题，同时自增也是靠锁实现的，会降低写入性能、阻塞事务。



### 索引失效

https://segmentfault.com/a/1190000021464570