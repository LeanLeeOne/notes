## 网关⭐

**Nginx**是很常见的网关，虽然性能优越，但是功能不如**Spring Gateway**全面，它仅做到了路由（静态资源访问）、限流、负载均衡等功能。

而**Gateway**支持不仅支持[限流](http://www.ityouknow.com/springcloud/2019/01/26/spring-cloud-gateway-limit.html#限速路由器)、负载均衡，还提供更加丰富的路由规则，以及过滤（熔断、重试等）、拦截（权限控制）、监控、安全等功能。

- **Gateway**的限流基于令牌桶，依赖**Redis**。
- **Gateway**的负载均衡基于**Ribbon**，负载均衡策略稍微丰富一些。
- **Gateway**是可配置的，并且可编码的。
  - **Nginx**虽然也支持路由，但是是基于正则匹配链接的，相比较而言，较为单一。



## 其它网关

**Zuul1**是基于**Servlet**的，阻塞式。

**Zuul2**基于**Netty**，非阻塞式，但是**Spring**未集成，因为在**Zuul2**出来之前，**Spring**已经开始了**Gateway**项目。



## 配置中心

### 诞生

配置中心是由常量、配置文件、配置库一步步演化来的，不同的配置形态适合不同规模的系统。

随着系统不断生长，单个服务/应用的功能会越来越复杂，相应的配置也会越来越多；同时，服务的数量也会越来越多，变得相对分散。这时，我们可以将这些配置从各个配置文件中“迁移”到数据库中进行集中管理，而服务/应用在启动时需到配置库中获取配置，另外，还应实现对配置变更的监听及实时生效。我们可以进一步将这部分逻辑进行剥离，剥离为单独的组件，也就是配置中心，而“服务/应用监听配置变更”也可改为配置中心进行推送。

也就是说，配置中心是用于集中管理不同环境、不同集群的配置，且配置修改后能实时应用到Client，当然，配置中心最好还能提供权限控制、友好的界面等实用功能。

### Spring Cloud Config

**Spring Cloud Config**也是将**Service Instance**分为两类：

1. Server：即配置中心，存储配置文件，接口形式发送配置文件。
2. Client：通过接口获取配置，并据此初始化自己。

Client在运行期间不会热更新配置，需要手动Refresh。

### Diamond[[1]](https://blog.hufeifei.cn/2020/04/Alibaba/Diamond/)

**Diamond**所谓的推送配置，实际上也只是客户端进行长轮询。

### XDiamond[[2]](https://github.com/hengyunabc/xdiamond/)

该配置中心从`groupId`、`artifactId`、`version`、`profile`四个维度来标识“配置文件”。

该配置中心底层采用**MySQL**来保存配置。

该配置中心以`secret key`防止非法获取配置。

> **XDiamond**源自淘宝的**Diamond**，但**XDiamond**、**Diamond**均已停止维护。

### Nacos



### Apollo[[2]](https://github.com/xwzpp/apollo-1)





## 消息代理

**Spring Cloud Bus**提供轻量级的消息代理，使用AMQP消息代理作为通道。

可以将手动Refresh改为自动触发对应Client的Refresh。

![](../images/6/bus-processing.jpg)