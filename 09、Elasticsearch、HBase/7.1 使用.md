## 建表

```sql
-- 指定表的类型和表的名称
CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name 
-- 指定每列的名称和类型
[(col_name data_type [COMMENT col_comment], ...)]
-- 对表的说明
[COMMENT table_comment]
-- 指定分区表的列名称，列类型
[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]
-- 指定每列的分隔符、数据类型的类型
[
[ROW FORMAT row_format] 
[STORED AS file_format]
| STORED BY 'storage.handler.class.name' [WITH SERDEPROPERTIES (...)] 
]
-- 指定数据文件存储在HDFS的什么位置
[LOCATION hdfs_path]
-- 表的属性设置
[TBLPROPERTIES (property_name=property_value, ...)] 
-- 子查询
[AS select_statement];
```

`[PARTITIONED BY ...]`

- 有些表往往不需要遍历全表，只需要遍历部分数据，这时，可以对这些表启用分区。
- 分区是按照<u>分区列</u>来划分数据的，<u>分区列</u>对应表目录下的子目录，每个子目录的名称实际上就是<u>分区列</u>的名称。
- <u>分区列</u>的定义与表中字段相似，但是与表中的字段无关，是独立的列。
- 数据往往是随时间来增长的，所以<u>分区列</u>往往会选择时间，按照年、月、周、日等粒度来分区。

`[AS select_statement]`

- 把<u>子查询</u>的结果作为一张新表。
- 适用于保存中间查询结果。

[此外](https://blog.csdn.net/helloxiaozhe/article/details/78443264)，还可以使用`LIKE`语句来复制另一个表：

```sql
CREATE TABLE IF NOT EXISTS empcopy2
LIKE emp;
```

### CSV

建立CSV格式的表

```

```



## 加载数据

```sql
LOAD DATA [LOCAL] INPATH 'file_path' [OVERWRITE] INTO TABLE table_name [PARTITION(partcol=val1,partcol2=val2...)]
```

`[LOCAL]`：是否从本地文件系统寻找文件，默认的是从**HDFS**上寻找文件。

`[OVERWRITE]`：是否覆盖表中已有的数据。

> **Hive**支持`INSERT`，但本质上还是创建**MapReduce**。



## 内部表与外部表

**Hive**[中的表可分为](https://blog.csdn.net/qq_36743482/article/details/78393678)`2`类：

- Managed Table，<span style=background:#ffb8b8>内部表</span>。
- External Table，<span style=background:#f8d2ff>外部表</span>，创建时需使用`EXTERNAL`修饰。

<span style=background:#ffb8b8>内部表</span>和<span style=background:#f8d2ff>外部表</span>的根本区别在于，<span style=background:#ffb8b8>内部表</span>数据由**Hive**自身管理，<span style=background:#f8d2ff>外部表</span>数据由**HDFS**管理：

- 删除
  - 删除<span style=background:#ffb8b8>内部表</span>，会直接删除元数据、数据。
  - 删除<span style=background:#f8d2ff>外部表</span>，仅会删除元数据，**HDFS**上的数据不会被删除。
- 元数据
  - 对<span style=background:#ffb8b8>内部表</span>的表结构和分区的修改，会直接同步到元数据。
  - 对<span style=background:#f8d2ff>外部表</span>的表结构和分区进行修改，则需要使用修复语句（`MSCK REPAIR TABLE table_name;`）。
- 位置
  - <span style=background:#ffb8b8>内部表</span>数据存储的位置是`hive.metastore.warehouse.dir`，默认值`/user/hive/warehouse`。
  - <span style=background:#f8d2ff>外部表</span>数据的存储位置由用户通过`LOCATION`进行指定，如未指定，**Hive**也会在数据存储到`/user/hive/warehouse`。

> <span style=background:#f8d2ff>外部表</span>[主要用于](http://www.jianshu.com/p/265456b606dc)多个部门之间的共享。

### 转换

```sql
-- 外部表转内部表
ALTER TABLE [table_name] SET TBLPROPERTIES('EXTERNAL'='FALSE');
-- 内部表转外部表
ALTER TABLE [table_name] SET TBLPROPERTIES('EXTERNAL'='TRUE');
-- 查看b转换是否生效
DESC FORMATTED tmp_conversion;
```

