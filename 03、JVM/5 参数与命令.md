## 常用JVM配置参数

- `-Xms`：设置<span style=background:#c9ccff>堆</span>的最小空间大小。
- `-Xmx`：设置<span style=background:#c9ccff>堆</span>的最大空间大小。
- `-Xmn`：设置**Young**大小。
- `-Xss`：每个线程的<span style=background:#f8d2ff>栈</span>内存大小。
- `-XX:NewSize`：设置**Young**最小空间大小。
- `-XX:MaxNewSize`：设置**Young**最大空间大小。
- `-XX:MaxPermSize`：设置**Permanent**最大空间大小。
- `-XX:MaxTenuringThreshold`：存活次数大于此值的对象进入**Old**。
- `-XX:NewRatio=4`：设置**Young**的和**Old**的内存比例为`1:4`。
- `-XX:PretenureSizeThreashold`：大于此值的对象直接分配到**Old**中。
- `-XX:PermSize`：设置**Permanent**最小空间大小。
- `-XX:SurvivorRatio=8`：设置新生代**Eden**和**Survivor**比例为`8:2`。
- `–XX:+UseParNewGC`：指定使用**ParNew** + **Serial Old**垃圾回收器组合。
- `-XX:+UseParallelOldGC`：指定使用**ParNew** + **ParNew Old**垃圾回收器组合。
- `-XX:+UseConcMarkSweepGC`：指定使用**ParNew**+**CMS**垃圾回收器组合。



## 命令

| 名称     | 全称                      | 说明                                                         |
| -------- | ------------------------- | ------------------------------------------------------------ |
| `jps`    | JVM Process Status Tool   | 查看JVM中的线程                                              |
| `jstat`  | JVM Statistics Monitoring | 监视虚拟机中的内存的状态，包括类加载、垃圾回收、内存等       |
| `jmp`    | JVM Memory Map            | 查看、生成<span style=background:#c9ccff>堆</span>信息       |
| `jhat`   | JVM Heap Analysis Tool    | 将`jmp`生成的<span style=background:#c9ccff>堆快照</span>文件加载，然后展示，用于分析 |
| `jstack` | JVM Stack                 | 生成当前线程的方法<span style=background:#f8d2ff>栈</span>的快照 |
| `jinfo`  | JVM Information           | 查看、调整JVM的运行参数                                      |



## GC调优

[Jvm 系列(五):Java GC 分析](http://www.ityouknow.com/jvm/2017/09/18/GC-Analysis.html)

- `jstat`
- GChisto
- GC Easy

[Jvm 系列(六):Java 服务 GC 参数调优案例](http://www.ityouknow.com/jvm/2017/09/19/GC-tuning.html)

- `jmp`



## 排查问题

1. 使用`top`排除非Java进程的可能。
2. 然后：
   1. 如果是内存占用过多，则使用`jmp`生成<span style=background:#c9ccff>堆快照</span>，排查**GC**和内存泄漏方面的问题。
      1. 使用`jhat`、`jconsole`加载<span style=background:#c9ccff>堆快照</span>，分析堆、对象的使用情况。
      2. 使用`jstat`、`jinfo`输出JVM状态、启动参数，结合<span style=background:#c9ccff>堆快照</span>进行分析。
   2. 如果是CPU占用过多，则使用`jstack`打印<span style=background:#f8d2ff>栈快照</span>，[排查程序是否出现了死循环等问题](https://blog.csdn.net/puhaiyang/article/details/78663942)。

