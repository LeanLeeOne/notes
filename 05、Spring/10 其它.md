## 异步

### 基本使用

[使用](https://www.cnblogs.com/duanxz/p/6782847.html)`@Async`修饰方法后，该方法在被调用时，就会被自动**异步**调用。

在方法上添加`@Async`后，还需要使用`@EnableAsync`开启**异步**/使**异步**生效。

`@EnableAsync`需与`@SpringBootApplication`或`@Configuration`放在一起。

### 线程池

`@Async`还可与<u>线程池</u>[搭配使用](https://www.cnblogs.com/duanxz/p/6084494.html)。

- 使用在一个方法中新建一个<u>线程池</u>并将其返回，同时使用`@Bean`修饰该方法，将该<u>线程池</u>注册。
- 在`@Async("threadPoolExecutorBeanName")`填入线程池的名称即可。

但如果多处都要使用<u>线程池</u>，那么`@Async("threadPoolExecutorBeanName")`这种方式就有些繁琐了，为此，Spring提供了`AsyncConfigurer`接口来解决。

[@Async使用方法总结](https://www.cnblogs.com/duanxz/p/6782933.html)

### 原理

[Aysnc的异步执行的线程池实现原理](https://www.cnblogs.com/duanxz/p/9438757.html)



## 失败重试

使用`@Retryable`修饰方法后，当该方法抛出异常时，Spring会[自动重试](https://blog.51cto.com/u_14482423/2988711)。

### `@Retryable`

`@Retryable`有以下参数：

- `value`：用于指定异常，默认为空。
  - 当指定异常发生时就会进行重试。
- `include`：等同于`value`。 
- `exclude`：指定不需要重试的异常，默认为空。
  - 如果`include`、`exclude`同时为空，所有异常都会重试。
- `maxAttemps`：最大重试次数，默认为`3`。 
- `backoff`：重试等待策略，默认为空。

`@Retryable`的`backoff`属性需与`@Backoff`搭配使用。

### `@Backoff`

`@Backoff`有如下参数：

- `delay`：指定重试的延时时间，默认为`1000`毫秒。
- `multiplier`：指定延迟的倍数，默认为空。
  - 比如设置`delay=5000`，`multiplier=2`，则第一次重试为`5秒`后，第二次为`(5x2)` `10秒`后，第三次为`(10x2)` `20`秒。

### `@EnableRetry`

在方法上添加`@Retryable`后，还需要使用`@EnableRetry`开启**异步**/使**异步**生效。

`@EnableRetry`需与`@SpringBootApplication`或`@Configuration`放在一起。

