### 限流

[限流算法](http://www.cnblogs.com/duanxz/p/4123068.html)：

1. <span style=background:#c2e2ff>计数器</span>

   1. 控制**QPS**，即维护一个单位时间内的计数器，超出的请求直接拒绝。

2. <span style=background:#c2e2ff>Rolling Window，滑动窗口</span>

   1. 将时间按段分为若干个格子，格子容量有限，每隔一段时间滑动一下窗口，时间段越细，限流越平滑、精细。
   2. <span style=background:#c2e2ff>计数器</span>可以看作是只有一个格子的滑动窗口。

3. 桶

   每秒固定处理请求数，多请求不会被执行；其处理能力是桶的容量加上速率。

   1. <span style=background:#c2e2ff>Leaky Bucket，漏桶</span>
      1. 请求是一滴滴的水，以固定速率流出。
      2. 请求少时，桶会干；请求过多时，桶会溢出，溢出的请求可直接拒绝，也可阻塞。
      3. 漏桶是在<span style=background:#c9ccff>出队</span>流量上限流，往往放在<span style=background:#c9ccff>调用方</span>。
   2. <span style=background:#c2e2ff>Token Bucket，令牌桶</span>
      1. 令牌对应一滴滴的水，以固定的速率流入，一个请求取一滴水。
      2. 请求少时，令牌充足，多出的令牌直接丢弃；请求多时，桶会稀缺，得不到令牌的请求不会被执行。
      3. 令牌桶是在<span style=background:#c9ccff>入队</span>流量上限流，往往放在<span style=background:#c9ccff>被调用方</span>

实现：

1. 对于单机应用，可用AtomicLong、Semaphore、Guava的Cache、Guava的RateLimiter（基于令牌桶算法）来实现限流。
2. 对于分布式应用，可用**Redis**（共享计数器，存储两个Key，一个用于计<span style=background:#c2e2ff>时</span>，一个用于计<span style=background:#c2e2ff>数</span>，若<span style=background:#c2e2ff>时</span>间内的<span style=background:#c2e2ff>数</span>量未超过阈值，则继续处理任务），还可以使用[Hytrix](https://www.cnblogs.com/duanxz/p/7519893.html)。



### 降级

丢卒保车，保证核心服务可用。

降级分类：

1. 自动化：自动降级、人工降级。
2. 读写：读降级、写降级。
3. 层级：多级降级。

降级方面：

1. 页面、页面片段、页面异步请求。
2. 服务功能。
3. 读降级（只读缓存）、写降级（只写缓存，之后异步更新到数据库）。
4. 爬虫降级、风控降级。



### 熔断

