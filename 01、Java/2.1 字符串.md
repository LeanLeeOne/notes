## 原理

**String**实际上是通过**字符数组**来实现的，当然，**Java9**开始使用**字节数组**来实现，以节省内存空间。

1. **Java9**还允许指定字符串拼接的策略。
2. **Java9**还增加`coder`属性来标识编码。

String在编译期间，会在<span style=background:#c2e2ff>字符串常量池</span>中创建一个值为该字面值的字符串对象，对于字面值相同的变量会引用同一个字符串对象。

1. 即`String a = "txt"`、`String b = "txt"`，引用的是同一个字符串对象。

2. 但是`String c = new String("txt")`这种方式略有不同，会先确认<span style=background:#c2e2ff>字符串常量池</span>中是否存在该字面值的字符串对象：

   1. 如果存在，则会在<span style=background:#c9ccff>堆</span>中新建一个字符串对象，并将<span style=background:#c2e2ff>字符串常量池</span>中的字符串对象内部的<u>字符数组</u>**引用为**自身的<u>字符数组</u>，即字符串对象不相同，但内部的<u>字符数组</u>相同。
   2. 如果不存在，则先在<span style=background:#c2e2ff>字符串常量池</span>中新建字符串对象，然后再在<span style=background:#c9ccff>堆</span>中新建字符串对象，并引用<span style=background:#c2e2ff>字符串常量池</span>中的字符串对象的<u>字符数组</u>。

关于“[字符串池](../03、JVM/2%20内存结构#常量池)”。



## 对象与引用

Java中的`=`不是赋值的意思，是引用的意思，是将对象的地址传递给变量。

变量存放于<span style=background:#f8d2ff>栈</span>，而（通过`new`创建的）对象存放于<span style=background:#c9ccff>堆</span>。



## 编码

### UTF8

采用<span style=background:#ffb8b8>变长</span>编码，即，采用高位字节确定编码长度，具有良好的容错能力，应用于传输。

中文为`3`字节。

### Unicode

采用<span style=background:#f8d2ff>定长</span>编码，两字节。

在Java中，`char`以及`String`在内存中都是以**Unicode**进行编码。

中文为`2`字节。

[使用`int[]`创建超长的**Unicode**编码](https://zhuanlan.zhihu.com/p/110307661)



## 字符串拼接

Java对`+`进行了重载，允许进行字符串拼接。

对于字符串常量的相加（或者说拼接），Java会使用`StringConcatFactory`进行优化。

字符串对象是<u>不可变的</u>，所以对于频繁的字符串相加，会带来频繁的字符串对象创建，而**StringBuilder**可以改善该问题。

对于`"a" + "b"`这种字面量的拼接，编译器<span style=background:#c2e2ff>编译时</span>会直接将其编译为`"ab"`，以减少对象的创建。

**StringBuilder**是一个采用<u>链式操作</u>的<u>可变</u>对象，预分配缓冲区，不会创建临时对象。

**StringBuffer**可以看作是**StringBuilder**的早期版本，它通过同步来保证**线程安全**，执行效率相对较低。

**String.join()**内部采用了**StringJoiner**来实现字符串的带分隔符拼接。

`String.substring()`可切割字符串，更多实用方法参照此[文章](https://www.cnblogs.com/abook/p/5527341.html)。